kube-prometheus-stack:
  grafana:
    adminPassword: "admin"

    service:
      type: NodePort
      nodePort: 32000

    defaultDashboardsEnabled: true

    sidecar:
      dashboards:
        enabled: true               # ConfigMap 읽어서 Grafana에 자동 반영
        label: grafana_dashboard    # ConfigMap 라벨 필터
        folder: /var/lib/grafana/dashboards

  prometheus:
    service:
      type: NodePort
      nodePort: 32001

  alertmanager:
    service:
      type: NodePort
      nodePort: 32002

    alertmanagerSpec:
      config:
        global:
          resolve_timeout: 5m

        route:
          receiver: "slack-noti"
          group_by: ['alertname', 'severity']
          group_wait: 10s
          group_interval: 2m
          repeat_interval: 1h

        receivers:
          - name: "slack-noti"
            slack_configs:
              - api_url: "https://hooks.slack.com/services/XXXX/XXXX/XXXX"
                channel: "#monitoring-alert"
                send_resolved: true

loki:
  persistence:
    enabled: false   # 비영구 저장 (Pending 방지)
  read:
    replicas: 1
  write:
    replicas: 1

promtail:
  serviceMonitor:
    enabled: true

  config:
    clients:
      - url: http://loki-gateway.monitoring.svc.cluster.local/loki/api/v1/push
        tenant_id: "default"

