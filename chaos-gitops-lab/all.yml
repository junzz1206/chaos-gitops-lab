# ─────────────────────────────────────────────
# group_vars/all.yml
# 목적: Chaos Engineering 전역 변수 정의
# 설명:
#   - 모든 플레이북(run_chaos_test.yml 등)에서 공통으로 불러옴
#   - 네임스페이스, 지속시간, 네트워크 지연, 로그 등 전역 제어
# ─────────────────────────────────────────────

# ─────────────────────────────────────────────
# 1️⃣ 테스트 기본 설정
# ─────────────────────────────────────────────
target_namespace: "app"        # Chaos 테스트 대상 네임스페이스
chaos_duration: 10s          # Chaos 지속 시간 (기본 10초)
network_delay_ms: 300        # 네트워크 지연 시간 (기본 300ms)
random_pod_kill_count: 2     # 랜덤 Pod Kill 시 삭제할 개수

# ─────────────────────────────────────────────
# 2️⃣ Chaos 로그 / 모니터링 관련
# ─────────────────────────────────────────────
chaos_log_path: /var/log/chaos_test.log    # Chaos 테스트 결과 로그 파일
chaos_report_dir: /tmp/chaos_reports       # Chaos 보고서 저장 디렉토리
enable_log_summary: true                   # 테스트 후 로그 요약 표시 여부

# ─────────────────────────────────────────────
# 3️⃣ 대상 서비스 및 티어
# ─────────────────────────────────────────────
chaos_services:                            # app 내 주요 서비스 정의
  frontend: frontend
  productcatalogservice: productcatalogservice
  cartservice: cartservice
  checkoutservice: checkoutservice
  paymentservice: paymentservice
  shippingservice: shippingservice
  emailservice: emailservice
  redis-cart: redis-cart

chaos_tiers:                               # 서비스 티어 분류
  frontend: frontend
  backend:
    - productcatalogservice
    - cartservice
    - checkoutservice
    - paymentservice
    - shippingservice
    - emailservice
  data:
    - redis-cart

# ─────────────────────────────────────────────
# 4️⃣ 복구 정책
# ─────────────────────────────────────────────
auto_recovery: true                        # Chaos 종료 후 자동 복구 여부
recovery_wait: 5                           # 복구 후 안정화 대기 시간(초)
recovery_targets:
  - cartservice
  - paymentservice
  - redis-cart
  - checkoutservice

# ─────────────────────────────────────────────
# 5️⃣ 네트워크 Chaos 옵션 (고급)
# ─────────────────────────────────────────────
network_chaos_options:
  delay: "{{ network_delay_ms }}ms"
  loss: 2%
  corrupt: 1%
  reorder: 1%

# ─────────────────────────────────────────────
# 6️⃣ 안전 설정
# ─────────────────────────────────────────────
abort_if_not_app_namespace: true            # app 네임스페이스 아닐 시 즉시 중단
max_parallel_chaos: 3                       # 동시에 허용할 Chaos 최대 수

