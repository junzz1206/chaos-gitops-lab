# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# íŒŒì¼ëª…: playbooks/chaos/run_service_kill.yml
# ëª©ì :
#   - ì—¬ëŸ¬ ì„œë¹„ìŠ¤(cart, payment, redis-cart ë“±)ì— Chaos Kill ì£¼ì…
#   - Internal ì‹¤íŒ¨ ì‹œ External ëª¨ë“œ ìë™ ì „í™˜
#   - GitLab / ArgoCD í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì§€ì • (TARGET_SERVICES)
#   - CLI fallback: vars.yml(service_targets)
#   - Deployment, RS, StatefulSet ë³µêµ¬ ì°¨ë‹¨
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

- name: Execute Targeted Service Kill Chaos (Internal / External Auto-Fallback)  # í”Œë ˆì´ë¶ ì´ë¦„ ì •ì˜
  hosts: k3s_master              # ì´ í”Œë ˆì´ë¶ì„ ì‹¤í–‰í•  ëŒ€ìƒ í˜¸ìŠ¤íŠ¸ (K3s ë§ˆìŠ¤í„° ë…¸ë“œ)
  become: yes                    # root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰
  vars:
    target_namespace: "app"      # Chaos í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì§€ì •
    chaos_log_path: "/var/log/chaos_test.log"  # Chaos ì‹¤í–‰ ë¡œê·¸ ê²½ë¡œ ì§€ì •
    recovery_wait: "{{ lookup('env','RECOVERY_WAIT') | default(60, true) | int }}"  # ë³µêµ¬ ëŒ€ê¸° ì‹œê°„ (ì´ˆ ë‹¨ìœ„)
    service_targets: []          # CLIì—ì„œ ì „ë‹¬ë°›ëŠ” fallback ì„œë¹„ìŠ¤ ë¦¬ìŠ¤íŠ¸
    kill_mode: "{{ lookup('env','SERVICE_MODE') | default('internal', true) }}"  # ì‹¤í–‰ ëª¨ë“œ (internal/external)
    disable_autorecover: "{{ lookup('env','DISABLE_AUTORECOVER') | default(true, true) | bool }}"  # ìë™ ë³µêµ¬ ë¹„í™œì„±í™” ì—¬ë¶€
    chaos_duration: "{{ lookup('env','CHAOS_DURATION') | default(30, true) | int }}"  # Chaos ìœ ì§€ ì‹œê°„(ì´ˆ)

  tasks:                         # ì´í•˜ë¶€í„° ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…(Task) ì •ì˜
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 1ï¸âƒ£ ENV / CLI ì„œë¹„ìŠ¤ ë¡œë“œ
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Resolve target services dynamically  # í™˜ê²½ë³€ìˆ˜ ë˜ëŠ” CLIë¡œë¶€í„° Chaos ëŒ€ìƒ ì„œë¹„ìŠ¤ íŒŒì‹±
      vars:
        env_services: "{{ lookup('env', 'TARGET_SERVICES') | default('', true) }}"  # CI/CDì—ì„œ í™˜ê²½ë³€ìˆ˜ë¡œ ì „ë‹¬ëœ ì„œë¹„ìŠ¤ëª… ê°€ì ¸ì˜¤ê¸°
      ansible.builtin.set_fact:  # íŒŒì‹± ê²°ê³¼ë¥¼ fact ë³€ìˆ˜ë¡œ ì„¤ì •
        effective_services: >-    # ì‹¤ì œë¡œ Chaosì— ì‚¬ìš©í•  ì„œë¹„ìŠ¤ ëª©ë¡
          {{
            (env_services.split(',') | map('trim') | list)   # í™˜ê²½ë³€ìˆ˜ì— ê°’ì´ ìˆë‹¤ë©´ ì‰¼í‘œ ê¸°ì¤€ìœ¼ë¡œ ë¦¬ìŠ¤íŠ¸í™”
            if env_services | length > 0                     # í™˜ê²½ë³€ìˆ˜ê°€ ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´
            else (service_targets | default([]))              # ë¹„ì–´ìˆìœ¼ë©´ vars.ymlì˜ fallback ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©
          }}
      changed_when: false         # ì´ TaskëŠ” ì‹œìŠ¤í…œ ë³€ê²½ì„ ìœ ë°œí•˜ì§€ ì•ŠìŒ

    - name: Show resolved services  # ìµœì¢… ì„œë¹„ìŠ¤ ëª©ë¡ ë””ë²„ê¹… ì¶œë ¥
      ansible.builtin.debug:
        msg: |                    # ë©€í‹°ë¼ì¸ ë©”ì‹œì§€ ì¶œë ¥
          ğŸ¯ Chaos ëŒ€ìƒ ì„œë¹„ìŠ¤:
          - ENV(TARGET_SERVICES): {{ lookup('env','TARGET_SERVICES') | default('N/A') }}  # í™˜ê²½ë³€ìˆ˜ ì…ë ¥ ê°’
          - Local(vars): {{ service_targets | default([]) }}                              # CLI ë˜ëŠ” vars.yml ê°’
          - Effective: {{ effective_services | join(', ') if effective_services | length > 0 else 'ëœë¤ ì„ íƒ ì—†ìŒ' }}  # ìµœì¢… í™•ì • ì„œë¹„ìŠ¤ ë¦¬ìŠ¤íŠ¸

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 2ï¸âƒ£ Safety Check
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Validate namespace     # ì˜ëª»ëœ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ Chaos ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ê²€ì¦
      ansible.builtin.assert:      # ì¡°ê±´ ê²€ì‚¬ ëª¨ë“ˆ ì‚¬ìš©
        that:
          - target_namespace == "app"  # ChaosëŠ” app ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë‚´ì—ì„œë§Œ ì‹¤í–‰ ê°€ëŠ¥
        fail_msg: "âŒ namespaceê°€ 'app'ì´ ì•„ë‹™ë‹ˆë‹¤."  # ì‹¤íŒ¨ ì‹œ ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶œë ¥
        success_msg: "âœ… namespace í™•ì¸ ì™„ë£Œ ('app')"  # ì„±ê³µ ì‹œ í™•ì¸ ë©”ì‹œì§€ ì¶œë ¥

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 3ï¸âƒ£ Internal Kill Mode
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Perform internal service kill  # Internal ëª¨ë“œë¡œ ì„œë¹„ìŠ¤ Pod ì‚­ì œ ìˆ˜í–‰
      when: kill_mode == "internal"        # kill_modeê°€ internalì¼ ë•Œë§Œ ì‹¤í–‰
      ansible.builtin.shell: |             # Shell ìŠ¤í¬ë¦½íŠ¸ë¥¼ í†µí•´ ì‹¤ì œ Kubernetes ëª…ë ¹ ì‹¤í–‰
        failed_svcs=""                     # ì‹¤íŒ¨í•œ ì„œë¹„ìŠ¤ ì´ë¦„ë“¤ì„ ëˆ„ì  ì €ì¥í•  ë³€ìˆ˜ ì´ˆê¸°í™”
        for svc in {{ effective_services | join(' ') | default('') }}; do  # ì„œë¹„ìŠ¤ ëª©ë¡ ë°˜ë³µ
          echo "[INTERNAL] $svc: disabling auto-recovery and deleting pods..."  # í˜„ì¬ ëŒ€ìƒ ì„œë¹„ìŠ¤ ì¶œë ¥
          kubectl get deploy -n {{ target_namespace }} -l app=$svc -o name | \  # Deployment ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            xargs -r -I{} kubectl scale {} -n {{ target_namespace }} --replicas=0 || true  # í•´ë‹¹ Deployment ë³µì œë³¸ ìˆ˜ 0ìœ¼ë¡œ ì¡°ì •
          kubectl get rs -n {{ target_namespace }} -l app=$svc -o name | \     # ReplicaSet ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            xargs -r -I{} kubectl scale {} -n {{ target_namespace }} --replicas=0 || true  # ReplicaSetë„ 0ìœ¼ë¡œ ì¡°ì •
          kubectl get sts -n {{ target_namespace }} -l app=$svc -o name | \    # StatefulSet ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
            xargs -r -I{} kubectl scale {} -n {{ target_namespace }} --replicas=0 || true  # StatefulSetë„ ë³µì œë³¸ 0ìœ¼ë¡œ ì„¤ì •

          PODS=$(kubectl get pods -n {{ target_namespace }} -l app=$svc -o name)  # ì„œë¹„ìŠ¤ì˜ ì‹¤ì œ Pod ëª©ë¡ ì¡°íšŒ
          if [ -z "$PODS" ]; then             # Podê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
            echo "[WARN] No pods found for $svc"  # ê²½ê³  ì¶œë ¥
            failed_svcs="$failed_svcs $svc"       # ì‹¤íŒ¨ ëª©ë¡ì— ì¶”ê°€
            continue                              # ë‹¤ìŒ ì„œë¹„ìŠ¤ë¡œ ë„˜ì–´ê°
          fi
          echo "[DELETE] Deleting pods for $svc"   # ì‚­ì œ ë¡œê·¸ ì¶œë ¥
          kubectl delete pod -n {{ target_namespace }} -l app=$svc --grace-period=0 --force || true  # Pod ê°•ì œ ì‚­ì œ
        done

        # ë‚´ë¶€ ì‹¤íŒ¨ ê°ì§€
        if echo "$failed_svcs" | grep -q .; then   # ì‹¤íŒ¨ ì„œë¹„ìŠ¤ê°€ ì¡´ì¬í•˜ë©´
          echo "[FAIL] Internal kill failed for:$failed_svcs"  # ì‹¤íŒ¨ ë©”ì‹œì§€ ì¶œë ¥
          exit 99                                  # ë¹„ì •ìƒ ì¢…ë£Œ ì½”ë“œ ë°˜í™˜ (fallback íŠ¸ë¦¬ê±°ìš©)
        fi
      register: internal_result    # ê²°ê³¼ë¥¼ internal_result ë³€ìˆ˜ì— ì €ì¥
      ignore_errors: yes           # ì˜¤ë¥˜ ë°œìƒ ì‹œ í”Œë ˆì´ ì¤‘ë‹¨í•˜ì§€ ì•ŠìŒ
      changed_when: true           # ì´ TaskëŠ” ì‹œìŠ¤í…œ ìƒíƒœ ë³€ê²½ìœ¼ë¡œ ê°„ì£¼

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 4ï¸âƒ£ Internal ì‹¤íŒ¨ ì‹œ External ì „í™˜
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Detect internal failure and switch  # ë‚´ë¶€ ì‹¤íŒ¨ ê°ì§€ í›„ external ëª¨ë“œë¡œ ì „í™˜
      when:
        - kill_mode == "internal"              # í˜„ì¬ ëª¨ë“œê°€ internalì¼ ë•Œë§Œ ì‹¤í–‰
        - internal_result.rc is defined        # ë°˜í™˜ ì½”ë“œ ì¡´ì¬ í™•ì¸
        - internal_result.rc != 0              # ì‹¤íŒ¨ ì½”ë“œê°€ 0ì´ ì•„ë‹ ê²½ìš°
      ansible.builtin.set_fact:
        kill_mode: "external"                  # external ëª¨ë“œë¡œ ê°•ì œ ì „í™˜
      changed_when: true                       # fact ë³€ê²½ìœ¼ë¡œ íƒœìŠ¤í¬ ìƒíƒœ ë³€ê²½ í‘œì‹œ

    - name: Announce fallback activation        # Fallback ëª¨ë“œ ì „í™˜ ì•Œë¦¼
      when: kill_mode == "external"             # external ëª¨ë“œì¼ ë•Œë§Œ ì‹¤í–‰
      ansible.builtin.debug:
        msg: "âš ï¸ Internal ì‹¤íŒ¨ â†’ External Chaos Pod ëª¨ë“œë¡œ ì „í™˜"  # ê²½ê³  ë©”ì‹œì§€ ì¶œë ¥

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 5ï¸âƒ£ External Mode - ì„œë¹„ìŠ¤ë³„ Chaos Pod ìƒì„±
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Launch chaos pods for external deletion  # External ëª¨ë“œ ì‹¤í–‰ ì‹œ Chaos Pod ìƒì„±
      when: kill_mode == "external"                 # external ëª¨ë“œì¼ ë•Œë§Œ ì‹¤í–‰
      ansible.builtin.shell: |                      # Shell ëª…ë ¹ì„ í†µí•´ Kubernetesì— Chaos Pod ìƒì„±
        for svc in {{ effective_services | join(' ') | default('') }}; do  # ê° ì„œë¹„ìŠ¤ ë°˜ë³µ
          echo "[EXTERNAL] Launching chaos pod for $svc..."  # ë¡œê·¸ ì¶œë ¥
          SUFFIX=$(cat /proc/sys/kernel/random/uuid | cut -c1-5)  # ë¬´ì‘ìœ„ 6ìë¦¬ UUID ìƒì„±
          kubectl run svc-chaos-$SUFFIX \                        # Chaos Pod ìƒì„± (ê³ ìœ  ì´ë¦„ ì‚¬ìš©)
            --image=nicolaka/netshoot:latest --restart=Never -n {{ target_namespace }} \  # netshoot ì´ë¯¸ì§€ ê¸°ë°˜ ë‹¨ë°œì„± Pod ìƒì„±
            --overrides='{                                          
              "spec": {                                            
                "containers": [{                                    
                  "name": "svc-chaos",                             
                  "image": "nicolaka/netshoot:latest",             
                  "command": ["/bin/sh","-c"],                      
                  "args": [                                         
                    "echo \"[CHAOS] Deleting pods for \$svc...\"; \  # $svcì˜ ì‹¤ì œ Pod ì‚­ì œ ìˆ˜í–‰
                     kubectl delete pod -n {{ target_namespace }} -l app=\$svc --grace-period=0 --force || true; \  # ì‚­ì œ ëª…ë ¹
                     echo \"[WAIT] Keeping offline for {{ chaos_duration }}s...\"; \  # Chaos ì§€ì† ì‹œê°„ ì¶œë ¥
                     sleep {{ chaos_duration }}; \                 # chaos_duration ì´ˆ ë™ì•ˆ ëŒ€ê¸°
                     echo \"[DONE] \$svc chaos complete.\";"        # ì™„ë£Œ ë¡œê·¸ ì¶œë ¥
                  ]                                               
                }]                                                
              }                                                  
            }' || true                                            # ì˜¤ë¥˜ ë°œìƒí•´ë„ ê³„ì† ì§„í–‰
        done
      register: external_result     # ì‹¤í–‰ ê²°ê³¼ ì €ì¥
      ignore_errors: yes            # ì˜¤ë¥˜ ë¬´ì‹œ
      changed_when: true            # ì‹œìŠ¤í…œ ë³€ê²½ìœ¼ë¡œ í‘œì‹œ

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 6ï¸âƒ£ ì•ˆì •í™” ëŒ€ê¸°
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Wait for recovery_wait seconds       # Chaos ì¢…ë£Œ í›„ ì•ˆì •í™” ëŒ€ê¸° ì‹œê°„
      ansible.builtin.pause:
        seconds: "{{ recovery_wait }}"           # recovery_wait ê°’ë§Œí¼ ëŒ€ê¸° (ê¸°ë³¸ 60ì´ˆ)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 7ï¸âƒ£ ìƒíƒœ ì ê²€
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Verify current pod states            # í˜„ì¬ Pod ìƒíƒœ ì ê²€
      ansible.builtin.shell: |
        kubectl get pods -n {{ target_namespace }} \
          -o custom-columns="NAME:.metadata.name,STATUS:.status.phase" --no-headers  # Pod ì´ë¦„ê³¼ ìƒíƒœë§Œ ì¶œë ¥
      register: pod_state                        # ê²°ê³¼ë¥¼ pod_state ë³€ìˆ˜ì— ì €ì¥
      ignore_errors: yes                         # ì˜¤ë¥˜ ë¬´ì‹œ
      changed_when: false                        # ë‹¨ìˆœ ì¡°íšŒì´ë¯€ë¡œ ë³€ê²½ ì—†ìŒ

    - name: Display pod state summary            # Pod ìƒíƒœ ìš”ì•½ ì¶œë ¥
      ansible.builtin.debug:
        msg: |
          âœ… Service Kill Chaos ì™„ë£Œ
          {{ pod_state.stdout | default('âš ï¸ Pod ìƒíƒœ ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.') }}  # Pod ìƒíƒœ ì •ë³´ ì¶œë ¥ ë˜ëŠ” ê²½ê³  í‘œì‹œ

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 8ï¸âƒ£ Chaos ë¡œê·¸ ê¸°ë¡
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Write chaos summary to log           # Chaos ê²°ê³¼ë¥¼ ë¡œê·¸ íŒŒì¼ì— ê¸°ë¡
      ansible.builtin.lineinfile:
        path: "{{ chaos_log_path }}"             # ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
        create: true                             # íŒŒì¼ì´ ì—†ìœ¼ë©´ ìƒˆë¡œ ìƒì„±
        line: |                                  # ë¡œê·¸ ë‚´ìš©
          [{{ lookup('pipe','date -Iseconds') }}] ServiceKill(ns={{ target_namespace }}) mode={{ kill_mode }} duration={{ chaos_duration }} targets={{ effective_services | join(', ') | default('none') }} result="{{ pod_state.stdout | default('N/A') | replace('\n','; ') }}"
      become: true                               # root ê¶Œí•œ í•„ìš” (ë¡œê·¸ íŒŒì¼ ê²½ë¡œ ì ‘ê·¼ìš©)

    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    # 9ï¸âƒ£ ìµœì¢… ìš”ì•½
    # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - name: Final summary                        # ìµœì¢… ê²°ê³¼ ìš”ì•½ ì¶œë ¥
      ansible.builtin.debug:
        msg: |                                   # ë©€í‹°ë¼ì¸ ì¶œë ¥
          âœ… Service Kill Chaos Completed
          - Namespace: {{ target_namespace }}     # ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í‘œì‹œ
          - Mode: {{ kill_mode }}                 # ì‹¤í–‰ ëª¨ë“œ (internal / external)
          - Targets: {{ effective_services | join(', ') | default('N/A') }}  # Chaos ì£¼ì… ëŒ€ìƒ
          - Duration: {{ chaos_duration }}ì´ˆ      # Chaos ìœ ì§€ ì‹œê°„
          - Recovery Wait: {{ recovery_wait }}ì´ˆ  # ë³µêµ¬ ëŒ€ê¸° ì‹œê°„
          - Log: {{ chaos_log_path }}             # Chaos ë¡œê·¸ íŒŒì¼ ê²½ë¡œ
