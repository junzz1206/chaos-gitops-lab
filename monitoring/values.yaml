# --- Kube-Prometheus-Stack ---
kube-prometheus-stack:
  grafana:
    service:
      type: NodePort
      nodePort: 32000
    sidecar:
      dashboards:
        enabled: true
        label: grafana_dashboard
        labelValue: "1"
      datasources:
        enabled: true
        defaultDatasourceEnabled: true
    additionalDataSources:
      - name: Loki
        type: loki
        uid: Loki
        url: http://loki:3100
        access: proxy
        jsonData:
          maxLines: 1000
  prometheus:
    service:
      type: NodePort
      nodePort: 32001
  alertmanager:
    service:
      type: NodePort
      nodePort: 32002

# --- Loki (Fix: Disable Structured Metadata) ---
loki:
  deploymentMode: SingleBinary
  loki:
    auth_enabled: false
    
    # [ğŸ”¥ í•µì‹¬ í•´ê²°ì±…] êµ¬í˜• ì¸ë±ìŠ¤(boltdb-shipper) ì‚¬ìš© ì‹œ ì´ ê¸°ëŠ¥ì„ êº¼ì•¼ í•¨
    limits_config:
      allow_structured_metadata: false

    commonConfig:
      replication_factor: 1
    schemaConfig:
      configs:
        - from: "2024-01-01"
          store: boltdb-shipper
          object_store: filesystem
          schema: v13
          index:
            prefix: loki_index_
            period: 24h
    storage:
      type: filesystem
    
    # ê¶Œí•œ ë¬¸ì œ ë°©ì§€ (Root ì‹¤í–‰ ìœ ì§€)
    podSecurityContext:
      runAsGroup: 0
      runAsUser: 0
      fsGroup: 0
    containerSecurityContext:
      readOnlyRootFilesystem: false

  singleBinary:
    replicas: 1
    persistence:
      enabled: true
      size: 10Gi
  
  # ë¶ˆí•„ìš” ì»´í¬ë„ŒíŠ¸ ë¹„í™œì„±í™”
  read: {replicas: 0}
  write: {replicas: 0}
  backend: {replicas: 0}
  gateway: {replicas: 0}
  lokiCanary: {enabled: false}
  test: {enabled: false}
  monitoring:
    selfMonitoring: {enabled: false}
  
  chunksCache:
    enabled: false

# --- Promtail ---
promtail:
  config:
    clients:
      - url: http://loki:3100/loki/api/v1/push
