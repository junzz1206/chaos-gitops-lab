---
# ─────────────────────────────────────────────
# chaos_network: 네트워크 지연/손실 카오스 실험
# ─────────────────────────────────────────────

- name: Apply network delay
  become: yes
  shell: |
    tc qdisc add dev eth0 root netem delay {{ delay_ms | default(300) }}ms
  ignore_errors: yes                          # 중복 적용 시 에러 무시

- name: Wait during network chaos
  wait_for:
    timeout: "{{ duration | default(60) }}"   # chaos 유지 시간

- name: Remove network delay
  become: yes
  shell: |
    tc qdisc del dev eth0 root netem
  ignore_errors: yes                          # 이미 삭제된 경우 무시

