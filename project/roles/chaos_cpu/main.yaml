---
# ─────────────────────────────────────────────
# chaos_cpu: CPU 부하 카오스 실험
# ─────────────────────────────────────────────

- name: Install stress-ng package
  become: yes
  package:
    name: stress-ng            # CPU 부하 테스트용 유틸리티
    state: present             # 설치되어 있지 않으면 설치

- name: Run CPU stress test
  become: yes
  shell: |
    stress-ng --cpu {{ cores | default(2) }} --timeout {{ duration | default(60) }}s
  async: "{{ duration | default(60) }}"       # 비동기로 실행
  poll: 0                                    # 백그라운드 실행
  ignore_errors: yes                         # 실패해도 무시 (카오스 목적)

- name: Wait for chaos duration
  wait_for:
    timeout: "{{ duration | default(60) }}"   # duration 동안 대기

