---
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# app-deploy.yaml â€” K3s í´ëŸ¬ìŠ¤í„° ì•± ë°°í¬ í”Œë ˆì´ë¶
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- name: ğŸš€ Deploy Application to K3s
  hosts: k3s_master                   # K3s ì„œë²„ ë…¸ë“œì—ì„œ ì‹¤í–‰
  become: yes
  vars:
    app_manifest_dir: "../../files/app-manifests"
  tasks:
    - name: Ensure kubectl is installed
      shell: which kubectl
      register: kubectl_check
      failed_when: kubectl_check.rc != 0

    - name: Copy app manifests to target
      copy:
        src: "{{ app_manifest_dir }}/"
        dest: /tmp/app-manifests/
        mode: '0644'

    - name: Apply manifests to cluster
      shell: kubectl apply -f /tmp/app-manifests/
      args:
        executable: /bin/bash

    - name: Wait until all pods are running
      shell: |
        kubectl wait --for=condition=Ready pods --all --timeout=120s -A
      args:
        executable: /bin/bash

    - name: Display deployed resources
      shell: kubectl get pods -A -o wide
      register: pods
    - debug:
        var: pods.stdout

